// Bilan Couple - Schema de base de données
// https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ============== MODELS ==============

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  firstName     String
  lastName      String
  avatarUrl     String?

  coupleId      String?
  couple        Couple?   @relation(fields: [coupleId], references: [id])

  bilans        BilanMensuel[]
  objectifs     ObjectifAnnuel[]

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Couple {
  id              String    @id @default(cuid())
  inviteCode      String    @unique
  name            String?
  anniversaryDate DateTime?

  users           User[]
  bilansCouple    BilanCouple[]
  objectifs       ObjectifAnnuelCouple[]

  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

// Bilan mensuel individuel (Rick ou Michelle)
model BilanMensuel {
  id          String          @id @default(cuid())
  year        Int
  month       Int             // 1-12

  userId      String
  user        User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  entries     BilanEntry[]

  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@unique([userId, year, month])
}

// Bilan mensuel du couple (fusionné/commun)
model BilanCouple {
  id          String          @id @default(cuid())
  year        Int
  month       Int             // 1-12

  coupleId    String
  couple      Couple          @relation(fields: [coupleId], references: [id], onDelete: Cascade)

  entries     BilanCoupleEntry[]

  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@unique([coupleId, year, month])
}

// Entrée de bilan individuel par catégorie
model BilanEntry {
  id                String       @id @default(cuid())
  category          CategoryType

  objectif          String       @db.Text  // Objectif du mois
  realise           String       @db.Text  // Ce qui a été réalisé
  pointsForts       String       @db.Text  // Points positifs
  pointsAmeliorer   String       @db.Text  // Points à améliorer

  bilanId           String
  bilan             BilanMensuel @relation(fields: [bilanId], references: [id], onDelete: Cascade)

  @@unique([bilanId, category])
}

// Entrée de bilan couple par catégorie
model BilanCoupleEntry {
  id                String       @id @default(cuid())
  category          CategoryType

  objectif          String       @db.Text
  realise           String       @db.Text
  pointsForts       String       @db.Text
  pointsAmeliorer   String       @db.Text

  bilanId           String
  bilan             BilanCouple  @relation(fields: [bilanId], references: [id], onDelete: Cascade)

  @@unique([bilanId, category])
}

// Objectif annuel (global pour l'année)
model ObjectifAnnuel {
  id            String          @id @default(cuid())
  year          Int
  title         String
  description   String?         @db.Text
  category      CategoryType
  status        ObjectifStatus  @default(EN_COURS)
  progress      Int             @default(0)  // 0-100%
  priority      PriorityLevel   @default(MEDIUM)

  userId        String
  user          User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  @@index([userId, year])
}

// Objectif annuel de couple
model ObjectifAnnuelCouple {
  id            String          @id @default(cuid())
  year          Int
  title         String
  description   String?         @db.Text
  category      CategoryType
  status        ObjectifStatus  @default(EN_COURS)
  progress      Int             @default(0)
  priority      PriorityLevel   @default(MEDIUM)

  coupleId      String
  couple        Couple          @relation(fields: [coupleId], references: [id], onDelete: Cascade)

  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  @@index([coupleId, year])
}

// ============== ENUMS ==============

enum CategoryType {
  FINANCES
  CARRIERE_BUSINESS
  SPIRITUALITE
  SANTE_SPORT
  ECOLE
}

enum ObjectifStatus {
  EN_COURS
  ATTEINT
  ABANDONNE
}

enum PriorityLevel {
  LOW
  MEDIUM
  HIGH
}
